(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{549:function(t,s,a){"use strict";a.r(s);var n=a(15),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"http缓冲机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http缓冲机制"}},[t._v("#")]),t._v(" HTTP缓冲机制")]),t._v(" "),a("h3",{attrs:{id:"缓冲分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓冲分类"}},[t._v("#")]),t._v(" 缓冲分类")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("缓冲分类")]),t._v(" "),a("th",[t._v("原理")]),t._v(" "),a("th",[t._v("优缺点")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("本地缓冲 200 from cache")]),t._v(" "),a("td",[t._v("直接从本地缓冲中获取响应，最快速最省流量，因为根本没有向服务器发送请求")]),t._v(" "),a("td",[t._v("本地读取，快速响应，不需要请求服务器")])]),t._v(" "),a("tr",[a("td",[t._v("协商缓冲 304 Not Modified")]),t._v(" "),a("td",[t._v("浏览器在本地没有命中的情况下，请求头发送一定校验数据到服务端，如果服务端没有改变，浏览器从本地响应返回304")]),t._v(" "),a("td",[t._v("快速，数据量很小，只发送基本的响应头信息，不发送响应体")])]),t._v(" "),a("tr",[a("td",[t._v("200")]),t._v(" "),a("td",[t._v("没有使用到缓冲，直接请求服务器")]),t._v(" "),a("td",[t._v("正常请求服务器")])])])]),t._v(" "),a("h3",{attrs:{id:"相关header"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关header"}},[t._v("#")]),t._v(" 相关Header")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Header")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Pragma")]),t._v(" "),a("td",[t._v("设置为no-cache表示禁用本地缓冲")])]),t._v(" "),a("tr",[a("td",[t._v("Expires")]),t._v(" "),a("td",[t._v("Http1.0时代用来启用本地缓冲的字段，expires值对应一个格林威治时间，告诉浏览器缓存失效的时刻，如果没到这个时刻，表示缓存有效")])]),t._v(" "),a("tr",[a("td",[t._v("Cache-Control")]),t._v(" "),a("td",[t._v("HTTP1.1 针对Expires时间不一致的解决方案运用cache-Control告知浏览器缓冲过期的时间间隔而不是时刻，即使具体时间不一致，也不影响缓冲的管理")])]),t._v(" "),a("tr",[a("td",[t._v("Last-Modified")]),t._v(" "),a("td",[t._v("通知浏览器资源最后的修改时间，可以用在服务端进行header返回")])]),t._v(" "),a("tr",[a("td",[t._v("HTTP_IF_MODIFIED_SINCE")]),t._v(" "),a("td",[t._v("客户端在请求时，自动携带Last-Modified头部信息")])]),t._v(" "),a("tr",[a("td",[t._v("ETag")]),t._v(" "),a("td",[t._v("文件的指纹标识符，如果文件内容修改，指纹会改变")])]),t._v(" "),a("tr",[a("td",[t._v("if-None-Match")]),t._v(" "),a("td",[t._v("本地缓冲失效，会携带此值去请求服务端，服务端判断该资源是否改变，如果没有改变，则直接使用本地缓冲，返回304")])])])]),t._v(" "),a("p",[t._v("Cache-Control：HTTP1.1 针对Expires时间不一致的解决方案运用cache-Control告知浏览器缓冲过期的时间间隔而不是时刻，即使具体时间不一致，也不影响缓冲的管理")]),t._v(" "),a("ol",[a("li",[t._v("no-store 禁止浏览器缓冲响应")]),t._v(" "),a("li",[t._v("no-cache 不使用本地缓冲，先发起和服务器协商")]),t._v(" "),a("li",[t._v("max-age = delta-seconds：告诉浏览器本地缓冲有效的最长期限，以秒为单位")])]),t._v(" "),a("p",[t._v("以下是对header相关的使用，会根据header的有效期响应内容")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$since")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'HTTP_IF_MODIFIED_SINCE'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$lifetime")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3600")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("strtotime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$since")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$lifetime")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'HTTP1.1 304 Not Modified'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'last-Modified:'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("gmdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'D,d M T H:i:s'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'GMT'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[t._v('"contents"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("h3",{attrs:{id:"缓冲策略的选择"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓冲策略的选择"}},[t._v("#")]),t._v(" 缓冲策略的选择")]),t._v(" "),a("p",[t._v("适合缓冲的内容 eg:经常不改变的文件")]),t._v(" "),a("ol",[a("li",[t._v("不变的图像、如logo、图标等")]),t._v(" "),a("li",[t._v("js、css静态文件")]),t._v(" "),a("li",[t._v("可下载的文件、媒体文件")])]),t._v(" "),a("p",[t._v("适合协商缓冲 eg:经常改变的文件")]),t._v(" "),a("ol",[a("li",[t._v("HTML文件")]),t._v(" "),a("li",[t._v("经常替换的图片")]),t._v(" "),a("li",[t._v("经常修改的js、css文件")])]),t._v(" "),a("p",[t._v("不适合做缓冲")]),t._v(" "),a("ol",[a("li",[t._v("用户隐私等敏感数据")]),t._v(" "),a("li",[t._v("经常改变的api数据接口")])]),t._v(" "),a("h2",{attrs:{id:"nginx配置缓冲策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置缓冲策略"}},[t._v("#")]),t._v(" Nginx配置缓冲策略")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("add_header")]),t._v(" "),a("td",[t._v("添加状态码为2xx和3xx的响应头信息 add_header name value [always]")])]),t._v(" "),a("tr",[a("td",[t._v("expires")]),t._v(" "),a("td",[t._v("通知浏览器过期时长")])])])]),t._v(" "),a("h3",{attrs:{id:"本地缓冲配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地缓冲配置"}},[t._v("#")]),t._v(" 本地缓冲配置")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("location ~ .*\\.(jpg|jpeg|gif|png|js|css)$\n{\n     // 缓冲30天 \n     expires      30d;\n     // 相当于cache-control设置为十年\n     expires      max;\n     add_header cache-control max-age=3600;\n}\n\nlocation ~ .*\\.(js|css)$\n{\n     // 缓冲12h\n     expires      12h;\n}\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("h3",{attrs:{id:"协商缓冲设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#协商缓冲设置"}},[t._v("#")]),t._v(" 协商缓冲设置")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("location ~ .*\\.(js|css)$\n{\n     // 缓冲12h\n     etag     on;\n}\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h2",{attrs:{id:"前端代码和资源的压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端代码和资源的压缩"}},[t._v("#")]),t._v(" 前端代码和资源的压缩")]),t._v(" "),a("p",[t._v("让资源文件缩小，加快文件在网络中的传输，让网页更快的展示，降低网络带宽和流量消耗 ,通常压缩的内容包括：Js、Css、图片、Html代码的压缩")]),t._v(" "),a("h3",{attrs:{id:"javasscript代码的压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#javasscript代码的压缩"}},[t._v("#")]),t._v(" JavasScript代码的压缩")]),t._v(" "),a("p",[t._v("去掉多余的空格和回车，替换长变量名，简化一些代码写法")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://tool.css-js.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("常用压缩工具"),a("OutboundLink")],1),t._v("： UglifyJS、YUICompressor、Closure、Compiler")]),t._v(" "),a("h3",{attrs:{id:"css代码的压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#css代码的压缩"}},[t._v("#")]),t._v(" Css代码的压缩")]),t._v(" "),a("p",[t._v("去掉空白符等，跟压缩js代码差不多")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://tool.css-js.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("常用压缩工具"),a("OutboundLink")],1),t._v("： Css Compressor")]),t._v(" "),a("h3",{attrs:{id:"html代码压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#html代码压缩"}},[t._v("#")]),t._v(" Html代码压缩")]),t._v(" "),a("p",[t._v("不建议使用代码压缩，有时会破坏代码结构，可以使用"),a("a",{attrs:{href:"https://www.iwesen.com/post/41.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gzip压缩"),a("OutboundLink")],1),t._v("，当然也可以使用htmlcompressor工具，不过转换后检查下代码结构")]),t._v(" "),a("h3",{attrs:{id:"图片的压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片的压缩"}},[t._v("#")]),t._v(" 图片的压缩")]),t._v(" "),a("p",[t._v("压缩工具：tinypng、JpegMini、ImageOptim")])])}),[],!1,null,null,null);s.default=e.exports}}]);