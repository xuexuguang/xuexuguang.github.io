(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{547:function(_,v,t){"use strict";t.r(v);var a=t(15),r=Object(a.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h2",{attrs:{id:"php如何解决网站大流量与高并发的问题？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#php如何解决网站大流量与高并发的问题？"}},[_._v("#")]),_._v(" PHP如何解决网站大流量与高并发的问题？")]),_._v(" "),t("h4",{attrs:{id:"考点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#考点"}},[_._v("#")]),_._v(" 考点")]),_._v(" "),t("ol",[t("li",[_._v("高并发架构相关概念")]),_._v(" "),t("li",[_._v("高并发解决方案案例")])]),_._v(" "),t("h4",{attrs:{id:"高并发是什么？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#高并发是什么？"}},[_._v("#")]),_._v(" 高并发是什么？")]),_._v(" "),t("p",[_._v("什么叫并发？所谓的并发就是某一个时间点，有多少个访问同时到来，那么什么叫高并发呢？通常一个系统的日PV在千万以上的，有可能是一个高并发系统。")]),_._v(" "),t("h4",{attrs:{id:"高并发关心的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#高并发关心的问题"}},[_._v("#")]),_._v(" 高并发关心的问题")]),_._v(" "),t("p",[_._v("指标说明")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("指标")]),_._v(" "),t("th",[_._v("描述")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("QPS")]),_._v(" "),t("td",[_._v("每秒钟请求或者查询的数量")])]),_._v(" "),t("tr",[t("td",[_._v("吞吐量")]),_._v(" "),t("td",[_._v("单位时间内处理的请求量")])]),_._v(" "),t("tr",[t("td",[_._v("响应时间")]),_._v(" "),t("td",[_._v("从请求发出到响应花费的时间")])]),_._v(" "),t("tr",[t("td",[_._v("PV")]),_._v(" "),t("td",[_._v("综合浏览量，即页面浏览量或者点击量，一个访客在24小时内访问的页面数量，同一个用户浏览一个页面作为一个PV")])]),_._v(" "),t("tr",[t("td",[_._v("UV")]),_._v(" "),t("td",[_._v("独立访客，一定时间范围内相同访客多次访问网站，计算为一个独立访客")])]),_._v(" "),t("tr",[t("td",[_._v("带宽")]),_._v(" "),t("td",[_._v("计算带宽大小需要关注峰值流量和页面的平均大小,峰值一般是平均值的倍数")])]),_._v(" "),t("tr",[t("td",[_._v("日网站带宽")]),_._v(" "),t("td",[_._v("PV/统计时间(换算到秒)*平均页面大小(单位kb)*8")])]),_._v(" "),t("tr",[t("td",[_._v("峰值每秒请求数(QPS)")]),_._v(" "),t("td",[_._v("(总PV数"),t("em",[_._v("80%)/(6小时秒数")]),_._v("20%)=峰值每秒请求数(QPS),基础原则：80%的访问量集中在20%的时间")])])])]),_._v(" "),t("p",[_._v("QPS不等于并发连接数，QPS是每秒HTTP请求数量，并发连接数是系统同时处理的请求数量")]),_._v(" "),t("h4",{attrs:{id:"压力测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#压力测试"}},[_._v("#")]),_._v(" 压力测试")]),_._v(" "),t("p",[_._v("压力测试：测试单台服务器能承受的最大并发、QPS值\n常用性能测试工具：ab、wrk、http_load、web bench、siege\nab：是Apache官方推出的工具，测试目标是基于url，用于测试Apache、Nginx的负载压力")]),_._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[_._v("ab -c 100 -n 5000\n")])]),_._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[_._v("1")]),t("br")])]),t("p",[_._v("注意事项：")]),_._v(" "),t("ol",[t("li",[_._v("测试机器与被测试机器分开")]),_._v(" "),t("li",[_._v("不要对线上服务器做压力测试")]),_._v(" "),t("li",[_._v("观察测试工具ab所在的机器，以及被测试的前端机的cpu、内存、网络等都不超过最高限度的75%")])]),_._v(" "),t("h4",{attrs:{id:"qps峰值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#qps峰值"}},[_._v("#")]),_._v(" QPS峰值")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("QPS")]),_._v(" "),t("th",[_._v("场景描述")]),_._v(" "),t("th",[_._v("解决方案")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("QPS达到50")]),_._v(" "),t("td",[_._v("小型网站")]),_._v(" "),t("td",[_._v("一般的服务器可以应付")])]),_._v(" "),t("tr",[t("td",[_._v("QPS达到100")]),_._v(" "),t("td",[_._v("假设关系型数据库每次请求在0.01s,单页面只有一个SQL查询，那么100QPS意味着1s完成100次请求，但是此时无法保证数据库查询可以完成100次")]),_._v(" "),t("td",[_._v("数据库缓冲层、数据库的负载均衡")])]),_._v(" "),t("tr",[t("td",[_._v("QPS达到800")]),_._v(" "),t("td",[_._v("假设我们使用的百兆带宽，那么网站出口的实际带宽是8M左右，假设每个页面只有10k，在这个并发条件下，百兆带宽已经吃完")]),_._v(" "),t("td",[_._v("CDN加速，负载均衡")])]),_._v(" "),t("tr",[t("td",[_._v("QPS达到1000")]),_._v(" "),t("td",[_._v("假设使用memcache缓冲查询数据，每个页面对Memcache的请求远大于直接对DB请求Memcache的悲观并发数在2w左右，但有可能在之前内网带宽已经吃完，表现出不稳定")]),_._v(" "),t("td",[_._v("静态HTML缓冲")])]),_._v(" "),t("tr",[t("td",[_._v("QPS达到2000")]),_._v(" "),t("td",[_._v("这个级别下，文件系统访问锁称为了灾难")]),_._v(" "),t("td",[_._v("做业务分离，分布式存储")])])])]),_._v(" "),t("h4",{attrs:{id:"高并发解决案例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#高并发解决案例"}},[_._v("#")]),_._v(" 高并发解决案例")]),_._v(" "),t("p",[_._v("流量优化：")]),_._v(" "),t("ol",[t("li",[_._v("防盗链处理")])]),_._v(" "),t("p",[_._v("前端优化：")]),_._v(" "),t("ol",[t("li",[_._v("减少http请求")]),_._v(" "),t("li",[_._v("添加异步请求")]),_._v(" "),t("li",[_._v("启用浏览器缓冲和文件压缩")]),_._v(" "),t("li",[_._v("CDN加速")]),_._v(" "),t("li",[_._v("建立单独的图片服务器")])]),_._v(" "),t("p",[_._v("服务端优化")]),_._v(" "),t("ol",[t("li",[_._v("动态语言静态化")]),_._v(" "),t("li",[_._v("动态语言并发处理")])]),_._v(" "),t("p",[_._v("数据层优化")]),_._v(" "),t("ol",[t("li",[_._v("数据库缓冲层的优化")]),_._v(" "),t("li",[_._v("MySQL数据层的优化")])]),_._v(" "),t("p",[_._v("架构优化")]),_._v(" "),t("ol",[t("li",[_._v("web服务负载均衡")])]),_._v(" "),t("h2",{attrs:{id:"相关连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关连接"}},[_._v("#")]),_._v(" 相关连接")]),_._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://blog.csdn.net/guchuanyun111/article/details/52056474",target:"_blank",rel:"noopener noreferrer"}},[_._v("高并发解决方案-负载均衡"),t("OutboundLink")],1)]),_._v(" "),t("li",[t("a",{attrs:{href:"https://blog.fundebug.com/2018/09/21/redis_incident/",target:"_blank",rel:"noopener noreferrer"}},[_._v("Redis 开发建议"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);v.default=r.exports}}]);