(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{548:function(s,a,t){"use strict";t.r(a);var e=t(15),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"web资源防盗链"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web资源防盗链"}},[s._v("#")]),s._v(" web资源防盗链")]),s._v(" "),t("h3",{attrs:{id:"什么是防盗链？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是防盗链？"}},[s._v("#")]),s._v(" 什么是防盗链？")]),s._v(" "),t("p",[s._v("所谓的盗链就是在自己的页面上展示不是自己网站的一些资源。常见的是小站盗用大站的图片、音乐等资源。那么防盗链就是通过技术手段防止别人绕过本站访问本站的资源，让绕过本站资源的展示页面失效。")]),s._v(" "),t("h3",{attrs:{id:"防盗链的工作原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防盗链的工作原理"}},[s._v("#")]),s._v(" 防盗链的工作原理")]),s._v(" "),t("p",[s._v("通过referer或者签名来检测网站的来源地址，如果是资源文件，则可以显示它的网页地址。如果检测到不是本站则进行阻止。")]),s._v(" "),t("h3",{attrs:{id:"实现方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现方式"}},[s._v("#")]),s._v(" 实现方式")]),s._v(" "),t("h4",{attrs:{id:"传统防盗链的处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#传统防盗链的处理"}},[s._v("#")]),s._v(" 传统防盗链的处理")]),s._v(" "),t("p",[s._v("Nginx模块ngx_http_referer_module用于阻挡来源非法的域名请求，Nginx指令valid_referers,全局变量$invalid_referer")]),s._v(" "),t("p",[s._v("valid_referers none|blocked|server_names|string;\nnone:'referer'来源头部为空的情况\nblocked：'refer'来源头部不为空，但是里面的值被代理或者防火墙删除，这些值不以http或者https开头")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 支持对目录进行防盗处理 location images/\nlocation ~ .*\\.(jpg|jpeg|gif|png|js|css)$\n{\n     expires      30d;\n     access_log /dev/null;\n     # 如果来源头部为空、来源头部不为空，但是里面的值被代理或者防火墙删除、来源test.server.com均正常显示\n     valid_referers none blocked test.server.com;\n     if ($invalid_referer){\n        return 404;\n     }\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"加密防盗链的处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加密防盗链的处理"}},[s._v("#")]),s._v(" 加密防盗链的处理")]),s._v(" "),t("p",[s._v("如果客户端刻意伪造referer，那么传统的防盗链就会失效，可以绕过防盗链。这个时候就需要使用签名的方式进行防范了。这里我们使用第三方HttpAccessKeyModule模块进行签名加密，然后图片访问的时候使用签名进行认证。")]),s._v(" "),t("p",[s._v("nginx的配置如下：")]),s._v(" "),t("div",{staticClass:"language-Lua line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[s._v("location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jpg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpeg"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("gif"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("js"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("css"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" accessKey on"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("off 模块开关\n    accesskey on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" accessKey_hashmethod md5"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("sha"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 签名加密方式\n    accesskey_hashmethod md5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" accessKey_arg GET参数名称\n    accesskey_arg sign"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     \n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" accesskey_signature 加密规则\n    accesskey_signature "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mypass$remote_addr"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v(" 使用mypass"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("客户端ip使用md5加密得到签名\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("配置好签名之后，我们访问图片的时候拿着签名进行认证就可以获取到正常的图片了")]),s._v(" "),t("div",{staticClass:"language-php line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sign")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("md5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'mypass'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_SERVER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'REMOTE_ADDR'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<img src = "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("png"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("sign"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sign")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('">"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"减少http请求的次数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#减少http请求的次数"}},[s._v("#")]),s._v(" 减少HTTP请求的次数")]),s._v(" "),t("h3",{attrs:{id:"为什么要减少http请求？"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么要减少http请求？"}},[s._v("#")]),s._v(" 为什么要减少HTTP请求？")]),s._v(" "),t("p",[s._v("性能黄金法则：只有10%-20%的最终用户响应时间花在了下载HTML文档上。其余的80%-90%时间花在了下载页面中的所有组件上。因此，改善响应时间最简单的途径就是减少HTTP请求的数量。")]),s._v(" "),t("h3",{attrs:{id:"减少http请求的方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#减少http请求的方式"}},[s._v("#")]),s._v(" 减少HTTP请求的方式")]),s._v(" "),t("p",[s._v("HTTP链接产生的开销：")]),s._v(" "),t("ol",[t("li",[s._v("域名解析")]),s._v(" "),t("li",[s._v("TCP连接")]),s._v(" "),t("li",[s._v("发送请求")]),s._v(" "),t("li",[s._v("等待")]),s._v(" "),t("li",[s._v("下载资源")]),s._v(" "),t("li",[s._v("解析时间")])]),s._v(" "),t("p",[s._v("常用的解决方式")]),s._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"https://blog.csdn.net/an1090239782/article/details/78166983",target:"_blank",rel:"noopener noreferrer"}},[s._v("图片地图"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/an1090239782/article/details/78166983",target:"_blank",rel:"noopener noreferrer"}},[s._v("css脚本精灵"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("合并多个脚本为一个脚本")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/apaking/article/details/8331585",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用Base64编码嵌入图片"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);