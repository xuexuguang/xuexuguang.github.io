(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{542:function(s,a,t){"use strict";t.r(a);var e=t(15),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mysql的sql语句编写"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql的sql语句编写"}},[s._v("#")]),s._v(" MySQL的SQL语句编写")]),s._v(" "),t("h2",{attrs:{id:"关联更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关联更新"}},[s._v("#")]),s._v(" 关联更新")]),s._v(" "),t("div",{staticClass:"language-SQL line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("B "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Where")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("age "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" A "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" B "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("age "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"关联查询语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关联查询语句"}},[s._v("#")]),s._v(" 关联查询语句")]),s._v(" "),t("p",[s._v("六种关联查询")]),s._v(" "),t("p",[t("strong",[s._v("交叉连接(CROSS JOIN):没有任何关联条件，结果是笛卡尔积，结果集很大，没有意义")])]),s._v(" "),t("div",{staticClass:"language-SQL line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("C"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CROSS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CROSS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" C"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("内连接(INNER JOIN)：多表中同时符合某种条件的数据记录的集合")])]),s._v(" "),t("div",{staticClass:"language-SQL line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("B "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id \n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" B "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等值连接 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" B "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不等值连接 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" B "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自连接 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A T1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" A T2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" T1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" T2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[t("strong",[s._v("外连接(LEFT OUTER JOIN/RIGHT OUTER JOIN)：以左表为主，先查询出左表，按照ON后的关联条件匹配右表，没有匹配到的用NULL填充，可以简写成LEFT JOIN")])]),s._v(" "),t("p",[t("strong",[s._v("联合查询(UNION与UNION ALL)：把多个结果集集中在一起，UNION之前的结果集为基准，需要注意的是联合查询的列数要相等，相同的记录行会合并。如果使用UNION ALL不会合并重复记录")])]),s._v(" "),t("div",{staticClass:"language-SQL line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNION")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" B \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("全连接(FULL JOIN)：MySQL不支持全连接")])]),s._v(" "),t("div",{staticClass:"language-SQL line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" B "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNION")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RIGHT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" B "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("嵌套查询：用一条SQL语句的结果作为另外一条SQL语句的条件")])]),s._v(" "),t("div",{staticClass:"language-SQL line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" A "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" B"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h1",{attrs:{id:"mysql的查询优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql的查询优化"}},[s._v("#")]),s._v(" MySQL的查询优化")]),s._v(" "),t("h2",{attrs:{id:"查找分析查询速度慢的原因"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查找分析查询速度慢的原因"}},[s._v("#")]),s._v(" 查找分析查询速度慢的原因")]),s._v(" "),t("ul",[t("li",[s._v("记录慢查询日记, 分析查询日记，不要直接打开慢查询日志分析，这样比较浪费时间和精力，可以使用pt-query-digest工具进行分析")]),s._v(" "),t("li",[s._v("使用show_profile,使用set profiling = 1开启，服务器上执行的所有语句会检测消耗的时间，存到临时表中")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 开启show_profile\nset profiling = 1;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("查看SQL语句临时表")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("show profiles;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("查看每条语句执行的历程")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("show profile for query 临时表ID;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("show status会返回一些计数器，show global status 查看服务器级别的所有计数，有时根据这些计数，可以猜测出哪些操作代价较高或者消耗时间多")])]),s._v(" "),t("div",{staticClass:"language-SQL line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("观察是否有大量的线程处于不正常的状态")])]),s._v(" "),t("div",{staticClass:"language-SQL line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" processlist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("使用explain分析单条SQL使用情况")])]),s._v(" "),t("div",{staticClass:"language-SQL line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("explain")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"优化查询过程中的数据访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化查询过程中的数据访问"}},[s._v("#")]),s._v(" 优化查询过程中的数据访问")]),s._v(" "),t("ul",[t("li",[s._v("访问数据太多导致查询性能下降")]),s._v(" "),t("li",[s._v("确认应用程序是否在检索大量超过需要的数据，可能是太多行或列")]),s._v(" "),t("li",[s._v("确认MySQL是否在分析不必要的数据行")]),s._v(" "),t("li",[s._v("避免使用如下SQL语句：\n"),t("ul",[t("li",[s._v("查询不需要的记录，使用limit解决")]),s._v(" "),t("li",[s._v("多表关联返回全部列,指定A.id,A.name")]),s._v(" "),t("li",[s._v("避免使用SELECT *")]),s._v(" "),t("li",[s._v("重复查询相当的数据，可以缓冲数据，下次直接读取缓冲")])])]),s._v(" "),t("li",[s._v("是否在扫描额外的记录，使用explain进行分析，如果发现查询需要扫描大量的数据，但只返回少数的行，可以通过如下技巧去优化。使用索引覆盖扫描，把所有用的列放到索引中，这样存储引擎不需要回表获取对应行就可以返回结果")]),s._v(" "),t("li",[s._v("改变数据库和表的结构，修改数据表范式")]),s._v(" "),t("li",[s._v("重写SQL语句，让优化器以更优的方式来执行")])]),s._v(" "),t("h2",{attrs:{id:"优化长难的查询语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化长难的查询语句"}},[s._v("#")]),s._v(" 优化长难的查询语句")]),s._v(" "),t("p",[t("strong",[s._v("一个复杂查询还是多个简单查询?")])]),s._v(" "),t("p",[s._v("MySQL内部每秒能扫描内存中上百万行数据，相比之下，响应数据给客户端就要慢的多。使用尽可能少的查询是好的，但是有的时候将一个大的查询分解为多个小的查询是很有必要的。")]),s._v(" "),t("h3",{attrs:{id:"切分查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#切分查询"}},[s._v("#")]),s._v(" 切分查询")]),s._v(" "),t("p",[s._v("将一个大的查询，切分为多个小的相同的查询，包含大数据拆分处理，一次处理一定量的数据。")]),s._v(" "),t("h3",{attrs:{id:"分解关联查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分解关联查询"}},[s._v("#")]),s._v(" 分解关联查询")]),s._v(" "),t("p",[s._v("可以将一条关联语句分解成多条SQL来执行,这样做的好处在于：")]),s._v(" "),t("ul",[t("li",[s._v("让缓冲的效率更高")]),s._v(" "),t("li",[s._v("执行单个查询可以减少锁的竞争")]),s._v(" "),t("li",[s._v("在应用层做关联可以更容易对数据进行拆分")])]),s._v(" "),t("h3",{attrs:{id:"优化特定类型的查询语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化特定类型的查询语句"}},[s._v("#")]),s._v(" 优化特定类型的查询语句")]),s._v(" "),t("h4",{attrs:{id:"优化count-查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化count-查询"}},[s._v("#")]),s._v(" 优化count()查询")]),s._v(" "),t("p",[s._v("count("),t("em",[s._v(")中会忽略所有的列，直接统计所有的列数，因此不要使用count(列名)。MyISAM中，没有任何条件的WHERE条件的count(")]),s._v(")非常快，当有WHERE条件，MyISAM的count统计不一定比其他表引擎快")]),s._v(" "),t("p",[s._v("优化方案为：")]),s._v(" "),t("ul",[t("li",[s._v("可以使用explain查询近似值，用近似值替代count(*)")]),s._v(" "),t("li",[s._v("增加汇总表")])]),s._v(" "),t("h4",{attrs:{id:"优化关联查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化关联查询"}},[s._v("#")]),s._v(" 优化关联查询")]),s._v(" "),t("ul",[t("li",[s._v("确定ON或者USING子句的列上有索引")]),s._v(" "),t("li",[s._v("确保GROUP BY和ORDER BY中只有一个表中的列，这样MySQL才有可能使用到索引")])]),s._v(" "),t("h4",{attrs:{id:"优化子查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化子查询"}},[s._v("#")]),s._v(" 优化子查询")]),s._v(" "),t("ul",[t("li",[s._v("尽可能的使用关联查询进行替代")])]),s._v(" "),t("h4",{attrs:{id:"优化group-by和distinct"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化group-by和distinct"}},[s._v("#")]),s._v(" 优化GROUP BY和DISTINCT")]),s._v(" "),t("ul",[t("li",[s._v("这两种查询均可使用索引来优化，是最有效的优化方法。关联查询中，使用标识列进行分组的效率会更高。如果不需要ORDER BY,进行GROUP BY时使用ORDER BY NULL,MySQL不会进行文件排序")]),s._v(" "),t("li",[s._v("WITH ROLLUP超级聚合，可以挪到应用程序处理")])]),s._v(" "),t("h4",{attrs:{id:"优化limit分页"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化limit分页"}},[s._v("#")]),s._v(" 优化LIMIT分页")]),s._v(" "),t("ul",[t("li",[s._v("可以记录上次查询的最大ID，下次查询时直接根据该ID查询")])]),s._v(" "),t("h4",{attrs:{id:"优化union查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化union查询"}},[s._v("#")]),s._v(" 优化UNION查询")]),s._v(" "),t("ul",[t("li",[s._v("UNION ALL的效率高于UNION")])])])}),[],!1,null,null,null);a.default=r.exports}}]);