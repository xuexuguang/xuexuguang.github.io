<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx进阶 | xiaoyi&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="web后端技术博客,简洁至上,专注web后端学习与总结。PHP,Go,Python,Linux,Mysql,Nginx,NoSQL,数据库中间件设计模式,git,github等技术文章。">
    <meta name="keywords" content="web后端技术博客,个人技术博客,后端,后端开发,后端框架,web后端,后端面试题,技术文档,学习,面试,PHP,Go,Python,Linux,Mysql,Nginx,NoSQL,python,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.751ac70c.css" as="style"><link rel="preload" href="/assets/js/app.80f2c921.js" as="script"><link rel="preload" href="/assets/js/3.32955ad4.js" as="script"><link rel="preload" href="/assets/js/89.223b065c.js" as="script"><link rel="prefetch" href="/assets/js/10.19032b12.js"><link rel="prefetch" href="/assets/js/11.62c9e55f.js"><link rel="prefetch" href="/assets/js/12.3bbf7476.js"><link rel="prefetch" href="/assets/js/13.942f5458.js"><link rel="prefetch" href="/assets/js/14.ec962833.js"><link rel="prefetch" href="/assets/js/15.8fa3c3f6.js"><link rel="prefetch" href="/assets/js/16.5f6b3469.js"><link rel="prefetch" href="/assets/js/17.35ccb5bc.js"><link rel="prefetch" href="/assets/js/18.bbb99e11.js"><link rel="prefetch" href="/assets/js/19.1921b5c5.js"><link rel="prefetch" href="/assets/js/20.c259f0a6.js"><link rel="prefetch" href="/assets/js/21.60638a54.js"><link rel="prefetch" href="/assets/js/22.27fe6095.js"><link rel="prefetch" href="/assets/js/23.8b3e17b6.js"><link rel="prefetch" href="/assets/js/24.0e018a7b.js"><link rel="prefetch" href="/assets/js/25.f42ea98e.js"><link rel="prefetch" href="/assets/js/26.9f92a887.js"><link rel="prefetch" href="/assets/js/27.7816f2f0.js"><link rel="prefetch" href="/assets/js/28.d056b36a.js"><link rel="prefetch" href="/assets/js/29.90679756.js"><link rel="prefetch" href="/assets/js/30.53367daa.js"><link rel="prefetch" href="/assets/js/31.d4223b7c.js"><link rel="prefetch" href="/assets/js/32.fb1195fc.js"><link rel="prefetch" href="/assets/js/33.c4686c25.js"><link rel="prefetch" href="/assets/js/34.cc264698.js"><link rel="prefetch" href="/assets/js/35.ee750c78.js"><link rel="prefetch" href="/assets/js/36.fb03df20.js"><link rel="prefetch" href="/assets/js/37.dc68b1fa.js"><link rel="prefetch" href="/assets/js/38.955f17b0.js"><link rel="prefetch" href="/assets/js/39.d69e5950.js"><link rel="prefetch" href="/assets/js/4.dfd27475.js"><link rel="prefetch" href="/assets/js/40.c8822389.js"><link rel="prefetch" href="/assets/js/41.42604c50.js"><link rel="prefetch" href="/assets/js/42.50b7b63c.js"><link rel="prefetch" href="/assets/js/43.75e8a21a.js"><link rel="prefetch" href="/assets/js/44.2c972d0e.js"><link rel="prefetch" href="/assets/js/45.b6f5e136.js"><link rel="prefetch" href="/assets/js/46.a4ad3a78.js"><link rel="prefetch" href="/assets/js/47.ee127cb0.js"><link rel="prefetch" href="/assets/js/48.9efd6df4.js"><link rel="prefetch" href="/assets/js/49.28106e58.js"><link rel="prefetch" href="/assets/js/5.42a818e9.js"><link rel="prefetch" href="/assets/js/50.ed658ae6.js"><link rel="prefetch" href="/assets/js/51.2ac1d3ce.js"><link rel="prefetch" href="/assets/js/52.348a67c3.js"><link rel="prefetch" href="/assets/js/53.828dcbe0.js"><link rel="prefetch" href="/assets/js/54.ded0023b.js"><link rel="prefetch" href="/assets/js/55.facca79a.js"><link rel="prefetch" href="/assets/js/56.a771fb97.js"><link rel="prefetch" href="/assets/js/57.3130984d.js"><link rel="prefetch" href="/assets/js/58.cb972a76.js"><link rel="prefetch" href="/assets/js/59.5b88fc47.js"><link rel="prefetch" href="/assets/js/6.7873b115.js"><link rel="prefetch" href="/assets/js/60.b8ab293f.js"><link rel="prefetch" href="/assets/js/61.29c6962e.js"><link rel="prefetch" href="/assets/js/62.d0c54283.js"><link rel="prefetch" href="/assets/js/63.ff8cff0a.js"><link rel="prefetch" href="/assets/js/64.a2555b20.js"><link rel="prefetch" href="/assets/js/65.8b25a990.js"><link rel="prefetch" href="/assets/js/66.aae81fee.js"><link rel="prefetch" href="/assets/js/67.8d8bfb7c.js"><link rel="prefetch" href="/assets/js/68.55c2cfbd.js"><link rel="prefetch" href="/assets/js/69.96c336a8.js"><link rel="prefetch" href="/assets/js/7.7976fbd1.js"><link rel="prefetch" href="/assets/js/70.c14f6ec9.js"><link rel="prefetch" href="/assets/js/71.62449697.js"><link rel="prefetch" href="/assets/js/72.c20a7f04.js"><link rel="prefetch" href="/assets/js/73.219580df.js"><link rel="prefetch" href="/assets/js/74.58bdda80.js"><link rel="prefetch" href="/assets/js/75.017ba741.js"><link rel="prefetch" href="/assets/js/76.2d8f7ba5.js"><link rel="prefetch" href="/assets/js/77.a0b0debf.js"><link rel="prefetch" href="/assets/js/78.1401b1b8.js"><link rel="prefetch" href="/assets/js/79.e1843d76.js"><link rel="prefetch" href="/assets/js/8.e386bd91.js"><link rel="prefetch" href="/assets/js/80.a61dc656.js"><link rel="prefetch" href="/assets/js/81.4b7e143e.js"><link rel="prefetch" href="/assets/js/82.6067e78c.js"><link rel="prefetch" href="/assets/js/83.250830ef.js"><link rel="prefetch" href="/assets/js/84.8c4f1bd4.js"><link rel="prefetch" href="/assets/js/85.e14c33ca.js"><link rel="prefetch" href="/assets/js/86.e046762c.js"><link rel="prefetch" href="/assets/js/87.2e70dccf.js"><link rel="prefetch" href="/assets/js/88.e0f7cab0.js"><link rel="prefetch" href="/assets/js/9.f07ef0ad.js"><link rel="prefetch" href="/assets/js/90.bbff7378.js"><link rel="prefetch" href="/assets/js/91.a2285ad8.js"><link rel="prefetch" href="/assets/js/92.0e5b3ecb.js"><link rel="prefetch" href="/assets/js/93.0f10a515.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.7c176c25.js">
    <link rel="stylesheet" href="/assets/css/0.styles.751ac70c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">xiaoyi's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3c9275/" class="nav-link">PHP</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/db/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">NoSQL</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">中间件</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务器" class="dropdown-title"><a href="/server/" class="link-title">服务器</a> <span class="title" style="display:none;">服务器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/pages/523932/" class="nav-link">Mac</a></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/nginx/" class="nav-link">《Nginx》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/eee83a9211a70f9d/" class="nav-link">资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xuexuguang/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://gitee.com/xuexuguang/images/raw/master/img/Snipaste_2020-11-30_14-44-20.png"> <div class="blogger-info"><h3>xuexuguang</h3> <span>后端新秀</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3c9275/" class="nav-link">PHP</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/db/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">NoSQL</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">中间件</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务器" class="dropdown-title"><a href="/server/" class="link-title">服务器</a> <span class="title" style="display:none;">服务器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/pages/523932/" class="nav-link">Mac</a></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/nginx/" class="nav-link">《Nginx》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/eee83a9211a70f9d/" class="nav-link">资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xuexuguang/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/pages/3cdea5/" aria-current="page" class="active sidebar-link">Nginx进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/3cdea5/#worker抢占机制" class="sidebar-link">worker抢占机制</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#传统服务器事件处理" class="sidebar-link">传统服务器事件处理</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#nginx事件处理" class="sidebar-link">Nginx事件处理</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#同步阻塞与异步阻塞" class="sidebar-link">同步阻塞与异步阻塞</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#nginx常用命令及指令" class="sidebar-link">Nginx常用命令及指令</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#日志切割" class="sidebar-link">日志切割</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#nginx实现跨域请求" class="sidebar-link">Nginx实现跨域请求</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#nginx配置静态资源防盗链" class="sidebar-link">Nginx配置静态资源防盗链</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#upstream指令参数" class="sidebar-link">upstream指令参数</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#keepalive" class="sidebar-link">keepalive</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#ip-hash" class="sidebar-link">Ip_hash</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#一致性hash算法" class="sidebar-link">一致性hash算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/3cdea5/#是什么？" class="sidebar-link">是什么？</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#基本原理" class="sidebar-link">基本原理</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#解决的问题" class="sidebar-link">解决的问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#url-hash" class="sidebar-link">url_hash</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#nginx缓存" class="sidebar-link">Nginx缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/3cdea5/#控制浏览器的缓存" class="sidebar-link">控制浏览器的缓存</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#反向代理缓存" class="sidebar-link">反向代理缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#keepalived双机主备原理" class="sidebar-link">Keepalived双机主备原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/3cdea5/#master" class="sidebar-link">master</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#backup" class="sidebar-link">backup</a></li><li class="sidebar-sub-header"><a href="/pages/3cdea5/#进程常驻" class="sidebar-link">进程常驻</a></li></ul></li></ul></li><li><a href="/pages/cd767a/" class="sidebar-link">lvs+keepalived高可用集群</a></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1b7c64bb><div class="articleInfo" data-v-1b7c64bb><ul class="breadcrumbs" data-v-1b7c64bb><li data-v-1b7c64bb><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1b7c64bb></a></li> <li data-v-1b7c64bb><a href="/categories/?category=%E3%80%8ANginx%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0" title="分类" data-v-1b7c64bb>《Nginx》学习笔记</a></li> <!----></ul> <div class="info" data-v-1b7c64bb><div title="作者" class="author iconfont icon-touxiang" data-v-1b7c64bb><a href="https://github.com/xuexuguang" target="_blank" title="作者" class="beLink" data-v-1b7c64bb>xuexuguang</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1b7c64bb><a href="javascript:;" data-v-1b7c64bb>2020-12-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          Nginx进阶
        </h1> <div class="theme-vdoing-content content__default"><h2 id="worker抢占机制"><a href="#worker抢占机制" class="header-anchor">#</a> worker抢占机制</h2> <p>master：一次性fork多个worker进程</p> <p>worker：基于互斥锁进行抢占client的请求，然后开始进行处理
<img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201202220701359.png" alt="image-20201202220701359" style="zoom:50%;"></p> <h2 id="传统服务器事件处理"><a href="#传统服务器事件处理" class="header-anchor">#</a> 传统服务器事件处理</h2> <p>客户端阻塞时，master进程通过fork进程来处理进程，大量的连接进来会耗尽服务器资源</p> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201203101228122.png" alt="image-20201203101228122" style="zoom:50%;"> <h2 id="nginx事件处理"><a href="#nginx事件处理" class="header-anchor">#</a> Nginx事件处理</h2> <p>Nginx通过使用epoll模型，使用异步非阻塞的形式监听客户端连接，当阻塞的时候，会自动切换到另一个客户端连接上。</p> <p>一个worker进程处理的最大连接数受限于nginx的worker_connections配置</p> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201202211428938.png" alt="image-20201202211428938" style="zoom:50%;"> <h2 id="同步阻塞与异步阻塞"><a href="#同步阻塞与异步阻塞" class="header-anchor">#</a> 同步阻塞与异步阻塞</h2> <table><thead><tr><th>方式</th> <th>说明</th></tr></thead> <tbody><tr><td>同步阻塞</td> <td>客户端阻塞等待服务器处理完成</td></tr> <tr><td>同步非阻塞</td> <td>客户端阻塞等待服务器处理，服务器可以异步处理其他任务</td></tr> <tr><td>异步阻塞</td> <td>客户端异步发送请求到服务器，服务器处理完回调客户端</td></tr> <tr><td>异步非阻塞</td> <td>客户端与服务端都是异步处理任务，处理完成回调给客户端</td></tr></tbody></table> <p>同步与异步的区别在于<font color="red">客户端是否阻塞等待</font>，阻塞与非阻塞的区别在于<font color="red">服务器是否阻塞等待</font></p> <h2 id="nginx常用命令及指令"><a href="#nginx常用命令及指令" class="header-anchor">#</a> Nginx常用命令及指令</h2> <p>常用命令</p> <table><thead><tr><th>命令</th> <th>说明</th></tr></thead> <tbody><tr><td>nginx -s stop</td> <td>强制停止nginx</td></tr> <tr><td>nginx -s quit</td> <td>等待nginx处理完请求再退出</td></tr> <tr><td>nginx -c nginx.conf</td> <td>指定nginx配置文件，可以解决invalid nginx pid的问题</td></tr></tbody></table> <p>指令</p> <table><thead><tr><th>指令</th> <th>说明</th></tr></thead> <tbody><tr><td>root</td> <td>location中会追加到root后面</td></tr> <tr><td>alias</td> <td>location中会以alias的路径为主</td></tr></tbody></table> <h2 id="日志切割"><a href="#日志切割" class="header-anchor">#</a> 日志切割</h2> <p>该方式会将现有的access.log和error.log的内容copy到新的文件中，新的请求进来内容依然会写到access.log</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 指定日志目录</span>
<span class="token assign-left variable">LOG_PATH</span><span class="token operator">=</span><span class="token string">&quot;/var/log/nginx/&quot;</span>

<span class="token comment"># 指定切割的日志格式</span>
<span class="token assign-left variable">RECORD_TIME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> -d <span class="token string">&quot;yesterday&quot;</span>+%Y-%m-%d<span class="token variable">)</span></span>
<span class="token assign-left variable">PID</span><span class="token operator">=</span>/var/run/nginx/nginx.pid

<span class="token comment"># 将默认的access_log和error_log重命名为拆分后的格式</span>
<span class="token function">mv</span> <span class="token variable">${LOG-PATH}</span>/access.log <span class="token variable">${LOG-PATH}</span>/access.<span class="token variable">${RECORD_TIME).log
mv ${LOG-PATH}</span>/error.log <span class="token variable">${LOG-PATH}</span>/error.<span class="token variable">${RECORD_TIME}</span>.Log

<span class="token comment"># 向Nginx主进程发送信号,用于重新打开日志文件</span>
<span class="token function">kill</span> -USR1 <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $PID<span class="token variable">`</span></span>

<span class="token comment"># 记得修改权限 chmod +x cut_log.sh </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>也可以通过定时任务去实现自动切割，这种方式相对比较老，更新的日志分割可以结合<a href="https://jingsam.github.io/2019/01/15/nginx-access-log.html" target="_blank" rel="noopener noreferrer">nginx变量实现区分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="nginx实现跨域请求"><a href="#nginx实现跨域请求" class="header-anchor">#</a> Nginx实现跨域请求</h2> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">90</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
    
    <span class="token comment"># 允许跨域请求的域, *代表所有</span>
    <span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token operator">*</span><span class="token punctuation">;</span>
    
    <span class="token comment"># 允许带上cookie请求</span>
    add header <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
    
    <span class="token comment"># 允许请求的方法,比如GET/POST/PUT/DELETE</span>
    add header <span class="token string">'Access-control-Allow-Methods'</span> <span class="token operator">*</span><span class="token punctuation">;</span>
    
    <span class="token comment"># 允许请求的header</span>
    <span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Headers'</span> <span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>跨域是浏览器的一种同源策略的限制，解决方法本质都是通过header头部的设置，除此之外还可以发送jsonp请求来解决跨域问题</p> <h2 id="nginx配置静态资源防盗链"><a href="#nginx配置静态资源防盗链" class="header-anchor">#</a> Nginx配置静态资源防盗链</h2> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">90</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> localhost<span class="token punctuation">;</span>
    
    <span class="token comment"># 通过验证refer头部来校验是否合法资源请求</span>
    <span class="token keyword">valid_referers</span> <span class="token operator">*</span><span class="token punctuation">.</span>imooc<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
    <span class="token comment"># 非法引入会进入下方判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token keyword">return</span> <span class="token number">404</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="upstream指令参数"><a href="#upstream指令参数" class="header-anchor">#</a> upstream指令参数</h2> <p>upstream主要用于配置nginx的负载均衡，下面是对常用的指令的整理</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment"># 负载均衡配置</span>
<span class="token keyword">upstream</span> tomcats <span class="token punctuation">{</span>
    <span class="token comment"># max_conns表示该server支持的最大连接数   </span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.173</span><span class="token punctuation">:</span><span class="token number">8080</span> max_conns<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    
    <span class="token comment"># weight表示权重值，请求大概率会打到该服务器上</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">8080</span> weight<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">;</span>
 
    <span class="token comment"># 1、通过server指令的slow_start参数来让其权重从0缓慢的恢复到正常值，避免大流量直接打进来再次压垮服务</span>
    <span class="token comment"># 2、商业版使用，该参数不能用在hash、randomloadbalancing中,如果只有一台服务器会失效</span>
    <span class="token comment"># 3、注意如果一个组里面只有一个server，那么max_fails，fail_timeout和slow_start参数都会被忽略。并且这个服务器永远都不会被认为是不可用的</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.175</span><span class="token punctuation">:</span><span class="token number">8080</span> slow_start<span class="token operator">=</span><span class="token number">60</span>s<span class="token punctuation">;</span>
   
    <span class="token comment"># down用于标记服务节点不可用</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.173</span><span class="token punctuation">:</span><span class="token number">8080</span> down<span class="token punctuation">;</span>
      
    <span class="token comment"># backup表示当前服务器节点是备用机，只有在其他的服务器都宕机以后，自己才会加入到集群中，被用户访问到，参数不能使用在hash和randomloadbalancing中</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.173</span><span class="token punctuation">:</span><span class="token number">8080</span> down<span class="token punctuation">;</span>
    
    <span class="token comment"># 表示在15秒内请求某一server失败达到2次后，则认为该server已经挂了或者宕机了，随后再过15秒，这15秒内不会有新的请求到达刚刚挂掉的节点上，而是会运作的server，15秒后会再有新请求尝试连接挂掉的server，如果还是失败，重复上一过程</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.173</span><span class="token punctuation">:</span><span class="token number">8080</span> max_fails<span class="token operator">=</span><span class="token number">2</span> fail_timeout<span class="token operator">=</span><span class="token number">15</span>s<span class="token punctuation">;</span>
    
    <span class="token comment"># 保持的活跃的链接，避免频繁的创建连接，带来的性能损耗</span>
    <span class="token keyword">keepalive</span> <span class="token number">32</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="keepalive"><a href="#keepalive" class="header-anchor">#</a> keepalive</h2> <p>主要是保持与后端的连接数，避免请求nginx的时候，不断的与后端建立连接带来的性能损耗。</p> <p>详细的可以参考<a href="https://www.cnblogs.com/kabi/p/7123354.html" target="_blank" rel="noopener noreferrer">keepalive的说明<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">upstream</span> tomcats <span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">8080</span> weight<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">;</span>  
    <span class="token comment"># 通过保持与客户端的长连接，来提高吞吐量，32为长连接的个数 </span>
    <span class="token keyword">keepalive</span> <span class="token number">32</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">http</span><span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>tomcats<span class="token punctuation">;</span>
        <span class="token comment"># 设置长连接使用的版本号 </span>
        <span class="token keyword">proxy_http_version</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
        <span class="token comment"># 设置cookie头的connection为空 </span>
        <span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>       
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="ip-hash"><a href="#ip-hash" class="header-anchor">#</a> Ip_hash</h2> <p>ip_hash可以保证用户访问可以请求到上游服务中的固定的服务器，前提是用户ip没有发生更改。
使用ip_hash的注意点：不能把后台服务器直接移除，只能标记为down</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">upstream</span> tomcats <span class="token punctuation">{</span>
    <span class="token keyword">ip_hash</span> <span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">808</span><span class="token punctuation">;</span>     
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">8080</span> down<span class="token punctuation">;</span>     
<span class="token punctuation">}</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">http</span><span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>tomcats<span class="token punctuation">;</span>       
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>hash算法：通过对ip进行hash计算，对节点个数进行求模，最后决定落到哪个节点</p> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201202211638113.png" alt="image-20201202211638113" style="zoom:50%;"> <p><strong>计算方式</strong></p> <table><thead><tr><th>参数</th> <th>描述</th></tr></thead> <tbody><tr><td>node_counts</td> <td>服务器的节点个数</td></tr> <tr><td>index</td> <td>服务器对应的索引</td></tr> <tr><td></td> <td></td></tr></tbody></table> <p>主要是通过<code>hash(ip) % node_counts = index</code> 最后计算得到index，根据index来匹配对应的服务器节点</p> <p>算法是根据ip的前3段来进行计算的，所以，<font color="red">同一段落的ip会落在同一台服务器上。</font></p> <h2 id="一致性hash算法"><a href="#一致性hash算法" class="header-anchor">#</a> 一致性hash算法</h2> <p>hash算法存在节点个数的变更，导致命中的服务器的index发生变化，为了解决该问题，出现了一致性hash算法</p> <h3 id="是什么？"><a href="#是什么？" class="header-anchor">#</a> 是什么？</h3> <p>一致性hash算法本质上是一个从0-2的32次方的线，最终形成的圆</p> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201202211832557.png" alt="image-20201202211832557" style="zoom:50%;"> <h3 id="基本原理"><a href="#基本原理" class="header-anchor">#</a> 基本原理</h3> <ol><li>通过对服务器的节点(ip或者主机)、用户的ip进行hash后，最终确认服务器节点的位置和用户所在的位置。</li> <li>按照顺时针的方向,选择最近的节点作为访问的节点</li></ol> <h3 id="解决的问题"><a href="#解决的问题" class="header-anchor">#</a> 解决的问题</h3> <p>传统的hash算法，节点个数的变更，会导致全部的用户的请求发生变化。</p> <p>一致性hash算法通过将服务器节点和用户的ip进行hash后，用户顺时针访问就近的节点，这样增加会移除节点影响的只是少部分用户。</p> <h2 id="url-hash"><a href="#url-hash" class="header-anchor">#</a> url_hash</h2> <p>根据url来路由到服务器的节点,计算方式：</p> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201202211909626.png" alt="image-20201202211909626" style="zoom:50%;"> <p>具体的配置</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">upstream</span> tomcats <span class="token punctuation">{</span>
    <span class="token comment"># 根据url进行hash，计算得到index作为服务器的索引</span>
    url hash<span class="token punctuation">;</span>
    <span class="token comment"># 路由请求到后端最少连接数的服务器上</span>
    <span class="token comment"># least_conn; </span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">808</span><span class="token punctuation">;</span>     
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.174</span><span class="token punctuation">:</span><span class="token number">8080</span> down<span class="token punctuation">;</span>     
<span class="token punctuation">}</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">http</span><span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>tomcats<span class="token punctuation">;</span>       
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>通过<font color="red">hash(url) % node_counts</font><code>计算得到</code>index`如果url中带有/，计算得到的hash结果是不一样的，会落到不同的服务节点上的。</p> <h2 id="nginx缓存"><a href="#nginx缓存" class="header-anchor">#</a> Nginx缓存</h2> <p>主要是缓存后端server的请求到服务器上，来缓解服务器本身的压力</p> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201202212013586.png" alt="image-20201202212013586" style="zoom:50%;"> <h3 id="控制浏览器的缓存"><a href="#控制浏览器的缓存" class="header-anchor">#</a> 控制浏览器的缓存</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span>html <span class="token punctuation">{</span>
   <span class="token keyword">alias</span> <span class="token operator">/</span>html<span class="token punctuation">;</span>
   <span class="token comment"># 10s后失效</span>
   <span class="token keyword">expires</span> <span class="token number">10</span>s<span class="token punctuation">;</span>
   <span class="token comment"># 到达指定的时间后失效</span>
   <span class="token comment"># expires @22h30m;</span>
   <span class="token comment"># 1小时前失效</span>
   <span class="token comment"># expires -1h;</span>
   <span class="token comment"># 不进行缓存</span>
   <span class="token comment"># expires epoch;</span>
   <span class="token comment"># 关闭，与epoch的区别在于off后浏览器保留默认的缓存机制</span>
   <span class="token comment"># expires off;</span>
   <span class="token comment"># 永不过期</span>
   <span class="token comment"># expires max;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>如果文件内容发生了变化，会重新请求浏览器，max-age表示缓存内容的有效期</p> <h3 id="反向代理缓存"><a href="#反向代理缓存" class="header-anchor">#</a> 反向代理缓存</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment"># 设置缓存保存的路径</span>
<span class="token comment">#   key_zone:设置共享空间和占用的空间大小</span>
<span class="token comment">#   max_size:设置缓存大小   </span>
<span class="token comment">#   inactive:设置缓存的有效期，超过此时间缓存自动清理  </span>
<span class="token comment">#   use_temp_path:关闭临时目录 </span>

<span class="token comment"># nginx会把请求服务器的内容缓存到该目录下，8h后会自动清理  </span>
<span class="token keyword">proxy_cache_path</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>upsteam_cache keys_zone<span class="token operator">=</span>mycache<span class="token punctuation">:</span><span class="token number">5</span>m max_size<span class="token operator">=</span><span class="token number">1</span>g inactive<span class="token operator">=</span><span class="token number">8</span>h use_temp_path<span class="token operator">=</span>off<span class="token punctuation">;</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token comment"># 启用缓存，和keys_zone一致</span>
    <span class="token keyword">proxy_cache</span> mycache<span class="token punctuation">;</span>
    <span class="token comment"># 针对200、304的状态码保留8h的有效期  </span>
    <span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">304</span> <span class="token number">8</span>h<span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">/</span><span class="token keyword">http</span><span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>tomcats<span class="token punctuation">;</span>       
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="keepalived双机主备原理"><a href="#keepalived双机主备原理" class="header-anchor">#</a> Keepalived双机主备原理</h2> <p>keepalived具有以下特点：</p> <ul><li>解决slb单点故障</li> <li>组件免费</li> <li>可以实现高可用的HA机制</li> <li>基于<a href="https://www.jianshu.com/p/7410507d57c3" target="_blank" rel="noopener noreferrer">VRRP协议<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>通过主备节点争抢ip的方式来保证负载均衡节点的高可用</p> <h3 id="master"><a href="#master" class="header-anchor">#</a> master</h3> <p>通过在192.168.1.171、192.168.1.172两台物理机上安装keepalived，来实现双机主备</p> <p>在机器192.168.1.171上配置msater节点</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code>global_defs <span class="token punctuation">{</span>
    <span class="token comment"># 路由id:当前安装keepalived的节点主机标识符，保证全局唯一</span>
    router_id keep_171
<span class="token punctuation">}</span>

vrrp_instance VI_1 <span class="token punctuation">{</span>
    <span class="token comment"># 表示状态是master主机还是backup备用机</span>
    state MASTER
    <span class="token comment"># 该实例绑定的网卡 </span>
    interface <span class="token class-name">ens33</span>
    <span class="token comment"># 保证主备节点一致即可  </span>
    virtual_router_id <span class="token number">51</span>
    <span class="token comment"># 权重, master权重一般高于backup,如果有多个,那就是选举,谁的权重高,谁就当选</span>
    priority <span class="token number">100</span>
    <span class="token comment"># 主备之间同步检查时间间隔，单位秒 </span>
    adver_int <span class="token number">2</span>
    <span class="token comment"># 认证权限密码,防止非法节点进入</span>
    authentication <span class="token punctuation">{</span>
        auth_type PASS
        auth_pass <span class="token number">1111</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># 虚拟出来的ip,可以有多个vip</span>
    virtual_ipaddress <span class="token punctuation">{</span>
        <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.161</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>服务启动后观察ip addr,发现192.168.1.161绑定到了网卡上了</p> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201202212247198.png" alt="image-20201202212247198" style="zoom:50%;"> <h3 id="backup"><a href="#backup" class="header-anchor">#</a> backup</h3> <p>在192.168.1.172上配置backup节点</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code>global_defs <span class="token punctuation">{</span>
    <span class="token comment"># 路由id:当前安装keepalived的节点主机标识符，保证全局唯一</span>
    router_id keep_172
<span class="token punctuation">}</span>

vrrp_instance VI_1 <span class="token punctuation">{</span>
    <span class="token comment"># 表示状态是master主机还是backup备用机</span>
    state BACKUP
    <span class="token comment"># 该实例绑定的网卡，当master节点宕机后，备用节点会替代master，会看到ens33的网卡下绑定了虚拟ip</span>
    interface <span class="token class-name">ens33</span>
    <span class="token comment"># 保证主备节点一致即可  </span>
    virtual_router_id <span class="token number">51</span>
    <span class="token comment"># 权重, 权重低于master节点</span>
    priority <span class="token number">80</span>
    <span class="token comment"># 主备之间同步检查时间间隔，单位秒 </span>
    adver_int <span class="token number">2</span>
    <span class="token comment"># 认证权限密码,防止非法节点进入</span>
    authentication <span class="token punctuation">{</span>
        auth_type PASS
        auth_pass <span class="token number">1111</span>
    <span class="token punctuation">}</span>
       
    virtual_ipaddress <span class="token punctuation">{</span>
        <span class="token comment"># 主备节点绑定的是同一个vip</span>
        <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.161</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>为支持syetemctl的使用，注册keepalived为系统服务</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 切换到keepalived的源目录下 </span>
<span class="token builtin class-name">cd</span> /usr/local/software/keepalived-2.0.20/keepalived/etc
<span class="token comment"># 将init.d目录中的keepalived文件拷贝到/etc/init.d目录中</span>
<span class="token function">cp</span> init.d/keepalived /etc/init.d/
<span class="token comment"># 将sysconfig目录中的keepalived文件拷贝到/etc/sysconfig目录中</span>
<span class="token function">cp</span> sysconfig/keepalived  /etc/sysconfig/
<span class="token comment"># 重新加载服务的配置文件</span>
systemctl daemon-reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>启动keepalived</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 启动keepalived</span>
syetemctl start keepalived
<span class="token comment"># 停止keepalived</span>
syetemctl stop keepalived
<span class="token comment"># 重启keepalived</span>
syetemctl restart keepalived
<span class="token comment"># 查看进程是否存在</span>
ps-ef<span class="token operator">|</span>grepkeepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>使用keepalived使nginx进程常驻</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 脚本存放到keepalived的配置目录下</span>
<span class="token function">vim</span> /etc/keepalived/check_nginx_alive_or_not.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="进程常驻"><a href="#进程常驻" class="header-anchor">#</a> 进程常驻</h3> <p>新增检查nginx进程脚本</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># !bin/bash</span>
nginx_process_total <span class="token operator">=</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> -c nginx --no-header <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">`</span></span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token variable">$nginx_process_total</span> -eq <span class="token number">0</span><span class="token punctuation">]</span>:then
    /usr/local/sbin/nginx
    <span class="token comment"># 等待一小会再次检查nginx，如果没有启动成功，则停止keepalived，使其启动</span>
    <span class="token function">sleep</span> <span class="token number">3</span>

		<span class="token comment"># 保证nginx进程常驻，如果没有正常拉起，则杀死keepalived，保证backup节点工作</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> -c nginx --no-header <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">`</span></span> -eq <span class="token number">0</span><span class="token punctuation">]</span>:then
        <span class="token function">killall</span> keepalived
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>新增脚本执行权限</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">chmod</span> +x /etc/keepalived/check_nginx_alive_or_not.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置keepalived监听nginx脚本</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code>global_defs <span class="token punctuation">{</span>
    router_id keep_172
<span class="token punctuation">}</span>

vrrp_script check_nginx_alive <span class="token punctuation">{</span>
    script <span class="token string">&quot;/etc/keepalived/check_nginx_alive_or_not.sh&quot;</span>
    interval <span class="token number">2</span> <span class="token comment"># 每搁两秒运行一次脚本</span>
    weight <span class="token number">10</span> <span class="token comment"># 脚本执行失败，则权重+10</span>
<span class="token punctuation">}</span>

vrrp_instance VI_1 <span class="token punctuation">{</span>        
    <span class="token comment"># vrrp_instance 中新增监听的脚本</span>
    track_script <span class="token punctuation">{</span>
        check_nginx_alive <span class="token comment"># 追踪nginx脚本</span>
    <span class="token punctuation">}</span>         
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>重启keepalived脚本</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code>systemctl restart keepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xuexuguang/notes/edit/master/docs/《Nginx》学习笔记/01.Nginx进阶.md" target="_blank" rel="noopener noreferrer">编辑</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020/12/31, 06:55:18</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/pages/cd767a/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">lvs+keepalived高可用集群</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/pages/cd767a/">lvs+keepalived高可用集群</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/49ff8e/"><div>MVC对比</div></a> <span>12-31</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/f43ef4/"><div>负载均衡</div></a> <span>12-31</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/ff8f14/"><div>数据库缓存优化</div></a> <span>12-31</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div> </main></div> <div class="footer"><div class="icons"><a href="mailto:769076918@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xuexuguang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://y.qq.com/portal/player.html" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2020
    <span>Evan Xu | <a href="https://gitee.com/xuexuguang/notes/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.80f2c921.js" defer></script><script src="/assets/js/3.32955ad4.js" defer></script><script src="/assets/js/89.223b065c.js" defer></script>
  </body>
</html>