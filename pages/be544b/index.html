<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>主从复制高可用Redis集群 | xiaoyi&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="web后端技术博客,简洁至上,专注web后端学习与总结。PHP,Go,Python,Linux,Mysql,Nginx,NoSQL,数据库中间件设计模式,git,github等技术文章。">
    <meta name="keywords" content="web后端技术博客,个人技术博客,后端,后端开发,后端框架,web后端,后端面试题,技术文档,学习,面试,PHP,Go,Python,Linux,Mysql,Nginx,NoSQL,python,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.751ac70c.css" as="style"><link rel="preload" href="/assets/js/app.80f2c921.js" as="script"><link rel="preload" href="/assets/js/3.32955ad4.js" as="script"><link rel="preload" href="/assets/js/17.35ccb5bc.js" as="script"><link rel="prefetch" href="/assets/js/10.19032b12.js"><link rel="prefetch" href="/assets/js/11.62c9e55f.js"><link rel="prefetch" href="/assets/js/12.3bbf7476.js"><link rel="prefetch" href="/assets/js/13.942f5458.js"><link rel="prefetch" href="/assets/js/14.ec962833.js"><link rel="prefetch" href="/assets/js/15.8fa3c3f6.js"><link rel="prefetch" href="/assets/js/16.5f6b3469.js"><link rel="prefetch" href="/assets/js/18.bbb99e11.js"><link rel="prefetch" href="/assets/js/19.1921b5c5.js"><link rel="prefetch" href="/assets/js/20.c259f0a6.js"><link rel="prefetch" href="/assets/js/21.60638a54.js"><link rel="prefetch" href="/assets/js/22.27fe6095.js"><link rel="prefetch" href="/assets/js/23.8b3e17b6.js"><link rel="prefetch" href="/assets/js/24.0e018a7b.js"><link rel="prefetch" href="/assets/js/25.f42ea98e.js"><link rel="prefetch" href="/assets/js/26.9f92a887.js"><link rel="prefetch" href="/assets/js/27.7816f2f0.js"><link rel="prefetch" href="/assets/js/28.d056b36a.js"><link rel="prefetch" href="/assets/js/29.90679756.js"><link rel="prefetch" href="/assets/js/30.53367daa.js"><link rel="prefetch" href="/assets/js/31.d4223b7c.js"><link rel="prefetch" href="/assets/js/32.fb1195fc.js"><link rel="prefetch" href="/assets/js/33.c4686c25.js"><link rel="prefetch" href="/assets/js/34.cc264698.js"><link rel="prefetch" href="/assets/js/35.ee750c78.js"><link rel="prefetch" href="/assets/js/36.fb03df20.js"><link rel="prefetch" href="/assets/js/37.dc68b1fa.js"><link rel="prefetch" href="/assets/js/38.955f17b0.js"><link rel="prefetch" href="/assets/js/39.d69e5950.js"><link rel="prefetch" href="/assets/js/4.dfd27475.js"><link rel="prefetch" href="/assets/js/40.c8822389.js"><link rel="prefetch" href="/assets/js/41.42604c50.js"><link rel="prefetch" href="/assets/js/42.50b7b63c.js"><link rel="prefetch" href="/assets/js/43.75e8a21a.js"><link rel="prefetch" href="/assets/js/44.2c972d0e.js"><link rel="prefetch" href="/assets/js/45.b6f5e136.js"><link rel="prefetch" href="/assets/js/46.a4ad3a78.js"><link rel="prefetch" href="/assets/js/47.ee127cb0.js"><link rel="prefetch" href="/assets/js/48.9efd6df4.js"><link rel="prefetch" href="/assets/js/49.28106e58.js"><link rel="prefetch" href="/assets/js/5.42a818e9.js"><link rel="prefetch" href="/assets/js/50.ed658ae6.js"><link rel="prefetch" href="/assets/js/51.2ac1d3ce.js"><link rel="prefetch" href="/assets/js/52.348a67c3.js"><link rel="prefetch" href="/assets/js/53.828dcbe0.js"><link rel="prefetch" href="/assets/js/54.ded0023b.js"><link rel="prefetch" href="/assets/js/55.facca79a.js"><link rel="prefetch" href="/assets/js/56.a771fb97.js"><link rel="prefetch" href="/assets/js/57.3130984d.js"><link rel="prefetch" href="/assets/js/58.cb972a76.js"><link rel="prefetch" href="/assets/js/59.5b88fc47.js"><link rel="prefetch" href="/assets/js/6.7873b115.js"><link rel="prefetch" href="/assets/js/60.b8ab293f.js"><link rel="prefetch" href="/assets/js/61.29c6962e.js"><link rel="prefetch" href="/assets/js/62.d0c54283.js"><link rel="prefetch" href="/assets/js/63.ff8cff0a.js"><link rel="prefetch" href="/assets/js/64.a2555b20.js"><link rel="prefetch" href="/assets/js/65.8b25a990.js"><link rel="prefetch" href="/assets/js/66.aae81fee.js"><link rel="prefetch" href="/assets/js/67.8d8bfb7c.js"><link rel="prefetch" href="/assets/js/68.55c2cfbd.js"><link rel="prefetch" href="/assets/js/69.96c336a8.js"><link rel="prefetch" href="/assets/js/7.7976fbd1.js"><link rel="prefetch" href="/assets/js/70.c14f6ec9.js"><link rel="prefetch" href="/assets/js/71.62449697.js"><link rel="prefetch" href="/assets/js/72.c20a7f04.js"><link rel="prefetch" href="/assets/js/73.219580df.js"><link rel="prefetch" href="/assets/js/74.58bdda80.js"><link rel="prefetch" href="/assets/js/75.017ba741.js"><link rel="prefetch" href="/assets/js/76.2d8f7ba5.js"><link rel="prefetch" href="/assets/js/77.a0b0debf.js"><link rel="prefetch" href="/assets/js/78.1401b1b8.js"><link rel="prefetch" href="/assets/js/79.e1843d76.js"><link rel="prefetch" href="/assets/js/8.e386bd91.js"><link rel="prefetch" href="/assets/js/80.a61dc656.js"><link rel="prefetch" href="/assets/js/81.4b7e143e.js"><link rel="prefetch" href="/assets/js/82.6067e78c.js"><link rel="prefetch" href="/assets/js/83.250830ef.js"><link rel="prefetch" href="/assets/js/84.8c4f1bd4.js"><link rel="prefetch" href="/assets/js/85.e14c33ca.js"><link rel="prefetch" href="/assets/js/86.e046762c.js"><link rel="prefetch" href="/assets/js/87.2e70dccf.js"><link rel="prefetch" href="/assets/js/88.e0f7cab0.js"><link rel="prefetch" href="/assets/js/89.223b065c.js"><link rel="prefetch" href="/assets/js/9.f07ef0ad.js"><link rel="prefetch" href="/assets/js/90.bbff7378.js"><link rel="prefetch" href="/assets/js/91.a2285ad8.js"><link rel="prefetch" href="/assets/js/92.0e5b3ecb.js"><link rel="prefetch" href="/assets/js/93.0f10a515.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.7c176c25.js">
    <link rel="stylesheet" href="/assets/css/0.styles.751ac70c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">xiaoyi's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3c9275/" class="nav-link">PHP</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/db/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">NoSQL</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">中间件</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务器" class="dropdown-title"><a href="/server/" class="link-title">服务器</a> <span class="title" style="display:none;">服务器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/pages/523932/" class="nav-link">Mac</a></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/nginx/" class="nav-link">《Nginx》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/eee83a9211a70f9d/" class="nav-link">资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xuexuguang/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://gitee.com/xuexuguang/images/raw/master/img/Snipaste_2020-11-30_14-44-20.png"> <div class="blogger-info"><h3>xuexuguang</h3> <span>后端新秀</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/3c9275/" class="nav-link">PHP</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/db/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">NoSQL</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">中间件</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务器" class="dropdown-title"><a href="/server/" class="link-title">服务器</a> <span class="title" style="display:none;">服务器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/pages/523932/" class="nav-link">Mac</a></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/nginx/" class="nav-link">《Nginx》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/eee83a9211a70f9d/" class="nav-link">资源</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xuexuguang/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>NoSQL</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ddfa16/" class="sidebar-link">Redis的事务与订阅</a></li><li><a href="/pages/be544b/" aria-current="page" class="active sidebar-link">主从复制高可用Redis集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/be544b/#缓存方案对比" class="sidebar-link">缓存方案对比</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#redis架构与原理解析" class="sidebar-link">Redis架构与原理解析</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#持久化" class="sidebar-link">持久化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/be544b/#rdb" class="sidebar-link">RDB</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#aof" class="sidebar-link">AOF</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#小结" class="sidebar-link">小结</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/be544b/#主从复制" class="sidebar-link">主从复制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/be544b/#基本原理" class="sidebar-link">基本原理</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#同步流程" class="sidebar-link">同步流程</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#主从搭建" class="sidebar-link">主从搭建</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/be544b/#无磁盘化复制" class="sidebar-link">无磁盘化复制</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#缓存清理" class="sidebar-link">缓存清理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/be544b/#主动删除" class="sidebar-link">主动删除</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#惰性删除" class="sidebar-link">惰性删除</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#淘汰策略" class="sidebar-link">淘汰策略</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/be544b/#哨兵模式" class="sidebar-link">哨兵模式</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#集群原理及解决方案" class="sidebar-link">集群原理及解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/be544b/#特点" class="sidebar-link">特点</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#集群容错" class="sidebar-link">集群容错</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#配置-3" class="sidebar-link">配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/be544b/#slot槽节点" class="sidebar-link">Slot槽节点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/be544b/#分配" class="sidebar-link">分配</a></li><li class="sidebar-sub-header"><a href="/pages/be544b/#存储" class="sidebar-link">存储</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/be544b/#参考链接" class="sidebar-link">参考链接</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库中间件</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1b7c64bb><div class="articleInfo" data-v-1b7c64bb><ul class="breadcrumbs" data-v-1b7c64bb><li data-v-1b7c64bb><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1b7c64bb></a></li> <li data-v-1b7c64bb><a href="/db" title="数据库-目录页" data-v-1b7c64bb>数据库</a></li> <li data-v-1b7c64bb><a href="/db/#NoSQL" title="数据库#NoSQL" data-v-1b7c64bb>NoSQL</a></li></ul> <div class="info" data-v-1b7c64bb><div title="作者" class="author iconfont icon-touxiang" data-v-1b7c64bb><a href="https://github.com/xuexuguang" target="_blank" title="作者" class="beLink" data-v-1b7c64bb>xuexuguang</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1b7c64bb><a href="javascript:;" data-v-1b7c64bb>2020-12-03</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          主从复制高可用Redis集群
        </h1> <div class="theme-vdoing-content content__default"><h2 id="缓存方案对比"><a href="#缓存方案对比" class="header-anchor">#</a> 缓存方案对比</h2> <table><thead><tr><th></th> <th>EhCache</th> <th>memcached</th> <th>Redis</th></tr></thead> <tbody><tr><td>优点</td> <td>基于java开发，与java项目的整合度更好；基于jvm缓存；轻巧方便</td> <td>kv存储；多核多线程；内存使用率高；</td> <td>丰富的数据结构；持久化；主从同步，故障转移；内存数据库；</td></tr> <tr><td>缺点</td> <td>不支持集群，分布式支持不友好，</td> <td>无法容灾，数据无法持久化；</td> <td>单线程、单核；</td></tr> <tr><td>适合场景</td> <td>适合单体应用，并发量较小的场景</td> <td>适合缓存热数据</td> <td>适合缓存、有存储需求的</td></tr></tbody></table> <h2 id="redis架构与原理解析"><a href="#redis架构与原理解析" class="header-anchor">#</a> Redis架构与原理解析</h2> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201203184416514.png" alt="image-20201203184416514" style="zoom:50%;"> <p>多路复用：redis的多路复用器是是同步非阻塞模型，可以高效的处理多个客户端的连接，通过将请求投递到队列</p> <p>文件事件分配器：通过从队列读取消息，分发到连接应答器</p> <p>连接应答器：读取事件分配器分发的任务，递交命令请求处理器处理</p> <h2 id="持久化"><a href="#持久化" class="header-anchor">#</a> 持久化</h2> <p>redis通过持久化来保证数据的可靠性，主要包括rdb和aof两种方式；</p> <h3 id="rdb"><a href="#rdb" class="header-anchor">#</a> RDB</h3> <p>每隔一段时间，通过将内存中的数据作为快照存储到磁盘的临时文件，发生宕机的时候，读取磁盘快照的方式来恢复数据。</p> <h4 id="优缺点"><a href="#优缺点" class="header-anchor">#</a> 优缺点</h4> <table><thead><tr><th>优点</th> <th>缺点</th></tr></thead> <tbody><tr><td>数据的全量备份</td> <td>发生故障时，会丢失最后一次的备份数据</td></tr> <tr><td>数据作为文件，可以远程传输</td> <td>子进程所占用的内存比会和父进程一模一样，如会造成CPU负担</td></tr> <tr><td>子进程备份的时候，主进程不会有任何io操作（不会有写入修改或删除），保证备份数据的的完整性</td> <td>由于定时全量备份是重量级操作，所以对于实时备份，就无法处理了</td></tr></tbody></table> <h4 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>save <span class="token number">9000</span> <span class="token number">1</span> <span class="token comment"># 如果1个缓存更新，则15分钟后备份</span>
save <span class="token number">300</span> <span class="token number">10</span> <span class="token comment"># 如果10个缓存更新，则5分钟后备份</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="aof"><a href="#aof" class="header-anchor">#</a> AOF</h3> <p>RDB会丢失最后一次备份的rdb文件，但是其实也无所谓，其实也可以忽略不计，毕竟是缓存，丢了就丢了，但是如果追求数据的完整性，那就考虑使用AOF，aof有如下的特点：</p> <ol><li>以日志的形式来记录用户请求的写操作。读操作不会记录，因为写操作才会存存储；</li> <li>文件以追加的形式而不是修改的形式；</li> <li>redis的aof恢复其实就是把追加的文件从开始到结尾读取执行写操作；</li></ol> <h4 id="优缺点-2"><a href="#优缺点-2" class="header-anchor">#</a> 优缺点</h4> <table><thead><tr><th>优点</th> <th>缺点</th></tr></thead> <tbody><tr><td>AOF更加耐用，可以以秒级别为单位备份，如果发生问题，也只会丢失最后一秒的数据，大大增加了可靠性和数据完整性。所以AOF可一次使用fsync操作</td> <td>相同的数据，同一份数据，AOF比RDB大</td></tr> <tr><td>以log日志形式追加，如果磁盘满了，会执行 redis-check-aof 工具</td> <td>针对不同的同步机制，AOF会比RDB慢，因为AOF每秒都会备份做写操作，这样相对与RDB来说就略低。每秒备份fsync没毛病，但是每次写入就做一次备份fsync的话，那么redis的性能就会下降</td></tr> <tr><td>当数据太大的时候，redis可以在后台自动重写aof。当redis继续把日志追加到老的文件中去时，重写也是非常安全的，不会影响客户端作</td> <td>AOF发生过bug，就是数据恢复的时候数据不完整，这样显得AOF会比较脆弱，容易出现bug，因为AOF没有RDB那么简单，但是呢为的产生，AOF就不会根据旧的指令去重构，而是根据当时缓存中存在的数据指令去做重构，这样就</td></tr> <tr><td>AOF 日志包含的所有写操作，会更加便于redis的解析恢复</td> <td></td></tr></tbody></table> <h4 id="配置-2"><a href="#配置-2" class="header-anchor">#</a> 配置</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># AOF默认关闭，yes可以开启</span>
appendonly no
<span class="token comment"># AOF的文件名</span>
append filename <span class="token string">&quot;appendonly.aof&quot;</span>
<span class="token comment"># no：不同步</span>
<span class="token comment"># everysec：每秒备份，推荐使用</span>
<span class="token comment"># always：每次操作都会备份，安全并且数据完整，但是慢性能差</span>
appendf <span class="token function">sync</span> everysec 
<span class="token comment"># 重写的时候是否要同步，no可以保证数据安全</span>
no-appendfsync-on-rewrite no
<span class="token comment"># 重写机制：避免文件越来越大，自动优化压缩指令，会fork一个新的进程去完成重写动作，新进程里的内存数据会被重写</span>
<span class="token comment">#当前AOF文件的大小是上次AOF大小的100%，并且文件体积达到64m，满足两者则触发重写</span>
auto-aof-rewrite-percentage <span class="token number">100</span>
auto-aof-rewrite-min-size 64mb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <p>到底采用RDB还是AOF呢？</p> <ol><li>如果你能接受一段时间的缓存丢失，那么可以使用RDB</li> <li>如果你对实时性的数据比较care，那么就用AOF</li></ol> <h2 id="主从复制"><a href="#主从复制" class="header-anchor">#</a> 主从复制</h2> <h3 id="基本原理"><a href="#基本原理" class="header-anchor">#</a> 基本原理</h3> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201214113835998.png" alt="image-20201214113835998" style="zoom:33%;"> <p>主从复制架构是一主一从或者一主多从，支持主节点复制数据到从，不支持从复制到主。通过主从的形式来提高数据的处理能力。</p> <h3 id="同步流程"><a href="#同步流程" class="header-anchor">#</a> <strong>同步流程</strong></h3> <ol><li>master节点开启持久化机制</li> <li>slave节点ping master节点确认互通</li> <li>master节点内存数据落到磁盘的rdb上</li> <li>通过内网传输到slave节点上</li> <li>slave节点下载rdb到磁盘后，加载到内存</li> <li>master节点后续新的写操作，同步传输到slave节点，slave节点更新内存数据</li></ol> <p>主从同步的时候，有以下几点注意：</p> <ul><li>数据同步过程中，读写不会进行阻塞，原因是由于对外提供的是老数据，数据同步完成后，会使用新数据提供服务</li> <li>slave节点宕机后，会进行增量数据恢复</li> <li>master节点必须开启持久化，否则重启后会导致数据清空</li></ul> <h3 id="主从搭建"><a href="#主从搭建" class="header-anchor">#</a> 主从搭建</h3> <p>配置从节点的redis的配置</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 配置master节点的ip和端口</span>
replicaof <span class="token operator">&lt;</span>master<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>masterport<span class="token operator">&gt;</span>
<span class="token comment"># master的密码</span>
masterauth <span class="token operator">&lt;</span>master-password<span class="token operator">&gt;</span>
<span class="token comment"># 是否只读</span>
replica-read-only <span class="token function">yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>重启redis</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">service</span> redis restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="无磁盘化复制"><a href="#无磁盘化复制" class="header-anchor">#</a> 无磁盘化复制</h2> <p>主要是通过socket的方式传输rdb数据，数据不会落到磁盘上。适用于网络性能好，磁盘吞吐量较低的情况下</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>repl-diskless-sync <span class="token function">yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="缓存清理"><a href="#缓存清理" class="header-anchor">#</a> 缓存清理</h2> <p>设置了expire的key缓存过期了，但是服务器的内存还是会被占用，这是因为redis所基于的两种删除策略：</p> <h3 id="主动删除"><a href="#主动删除" class="header-anchor">#</a> 主动删除</h3> <p>定时随机的检查过期的key，如果过期则清理删除。（每秒检查次数在redis.conf中的<a href="https://help.aliyun.com/document_detail/142171.html" target="_blank" rel="noopener noreferrer">hz<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>配置）</p> <h3 id="惰性删除"><a href="#惰性删除" class="header-anchor">#</a> 惰性删除</h3> <p>当客户端请求一个已经过期的key的时候，那么redis会检查这个key是否过期，如果过期了，则删除，然后返回一个nil</p> <h3 id="淘汰策略"><a href="#淘汰策略" class="header-anchor">#</a> 淘汰策略</h3> <p>maxmemory：当内存已使用率到达，则开始清理缓存</p> <table><thead><tr><th>策略</th> <th>说明</th></tr></thead> <tbody><tr><td>noeviction</td> <td>旧缓存永不过期，新缓存设置不了，返回错误</td></tr> <tr><td>allkeys-lru</td> <td>清除最少用的旧缓存，然后保存新的缓存（推荐使用）</td></tr> <tr><td>allkeys-random</td> <td>所有的缓存中随机删除（不推荐）</td></tr> <tr><td>volatile-lru</td> <td>在那些设置了expire过期时间的缓存中，清除最少用的旧缓存，然后保存新的缓存</td></tr> <tr><td>volatile-random</td> <td>在那些设置了expire过期时间的缓存中，随机删除缓存</td></tr> <tr><td>volatile-ttl</td> <td>在那些设置了expire过期时间的缓存中，删除即将过期的</td></tr></tbody></table> <h2 id="哨兵模式"><a href="#哨兵模式" class="header-anchor">#</a> 哨兵模式</h2> <p>哨兵是由多个节点组成的，用于监控redis各个节点的状态，宕机之后选取新的master节点来保证服务的可用性。</p> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201215102752537.png" alt="image-20201215102752537" style="zoom:33%;"> <p><strong>配置哨兵</strong></p> <p>在多台机器配置哨兵，监控redis的master、slave</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## 通用配置</span>
<span class="token comment"># 关闭受保护模式，方便哨兵各个节点相互访问</span>
protected-mode no 
port <span class="token number">26379</span> 
daemonize <span class="token function">yes</span>
pidfile /var/run/redis-sentinel pid
Logfile /usr/Local/redis/sentinel/Redis-sentinel Log <span class="token function">dir</span> /usr/Local/redis/sentinel

<span class="token comment">## 核心配置</span>
<span class="token comment"># 该行的意思是：监控的master的名字叫做mymaster （可以自定义），地址为192.168.1.191:6379，行尾最后的一个2代表在sentinel集群中，多少个sentinel认为master死了，才能真正认为该master不可用了。</span>
sentinel monitor mymaster <span class="token number">192.168</span>.1.191 <span class="token number">6379</span> <span class="token number">2</span> 
<span class="token comment"># 密码为redis的密码</span>
sentinel auth-pass mymaster <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>
<span class="token comment"># master在30s内无法ping通，会被sentinel认定为失效</span>
sentinel down-after-mitliseconds mymaster <span class="token number">30000</span> 
<span class="token comment"># salve节点被选取为新的master节点后，支持同时给几个salve进行数据同步</span>
sentinel parallel-syncs mymaster <span class="token number">1</span>
<span class="token comment"># 主备切换的超时时间，哨兵要去做故障转移，这个时候哨兵也是一个进程，如果他没有去执行，超过这个时间后，会由其他的哨兵负责处理</span>
sentinel failover-timeout mymaster <span class="token number">180000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>启动哨兵</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>/usr/local/bin/redis-sentinel sentinel.conf 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>哨兵信息检查</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看mymaster下的master节点信息</span>
sentinel master mymaster
<span class="token comment"># 查看mymaster下的slaves节点信息</span>
sentinel slaves mymaster
<span class="token comment"># 查看mymaster下的哨兵节点信息</span>
sentinel sentinels mymaster
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>注</strong>：master宕机之后，重启之后，会变更为slave，这点跟keepalive的nginx的master是相反的。</p> <p>master宕机后如果没有设置密码，会出现数据不一致的问题，因为没有进行auth所以无法进行数据同步。一般master数据无法同步给slave的方案检查为如下：</p> <ol><li>网络通信问题，要保证互相ping通，内网互通。</li> <li>关闭防火墙，对应的端口开发（虚拟机中建议永久关闭防火墙，云服务器的话需要保证内网互通）。</li> <li>统一所有的密码，不要漏了某个节点没有设置</li></ol> <h2 id="集群原理及解决方案"><a href="#集群原理及解决方案" class="header-anchor">#</a> 集群原理及解决方案</h2> <p>主从复制以及哨兵，他们可以提高读的并发，但是单个master容量有限，数据达到一定程度会有瓶颈。这个时候可以通过水平扩展为多master集群。</p> <p>redis-cluster可以支撑多个master-slave，支持海量数据，实现高可用与高并发。</p> <p>哨兵模式其实也是一种集群，他能够提高读请求的并发，但是容错方面可能会有一些问题，比如master同步数据给slave的时候，slave上的数据就没有master新，数据同步需要时间的，1-2秒的数据会丢失。master恢复并转换成slave后，新数据则丢失；</p> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201215142517282.png" alt="image-20201215142517282" style="zoom:33%;"> <h3 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h3> <ol><li>每个节点知道彼此之间的关系，也会知道自己的角色，当然他们也会知道自己存在于一个集群环境中，他们彼此之间可以交互和通信，那么这些关系都会保存到某个配置文件中。</li> <li>客户端要和集群建立连接的话，只需要和其中一个建立关系就行。</li> <li>某个节点挂了，也是通过超过半数的节点来进行的检测，客观下线后主从切换。</li> <li>Redis中存在很多的插槽，又可以称之为槽节点，用于存储数据</li></ol> <h3 id="集群容错"><a href="#集群容错" class="header-anchor">#</a> 集群容错</h3> <p>构建Redis集群，至少需要3个节点作为master，以此组成一个高可用的集群，此外每个master都需要配备一个slave，所以整个集群需要6个节点，这也是最经典的集群，也可以称之为三主三从，容错性更佳。</p> <h3 id="配置-3"><a href="#配置-3" class="header-anchor">#</a> 配置</h3> <p>redis.conf的配置</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 开启集群模式</span>
cluster-enabled <span class="token function">yes</span>
<span class="token comment"># 每一个节点需要有一个配置文件，需要6份。每个节点处于集群的角色都需要告知其他所有节点</span>
cluster-config-file nodes-201.conf
<span class="token comment"># 超时时间，超时则认为master宕机，随后主备切换</span>
cluster-node-timeout <span class="token number">5000</span>
<span class="token comment"># 开启AOF</span>
appendonly <span class="token function">yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>启动redis的实例</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 启动过程有问题，删除rdb文件</span>
<span class="token function">service</span> redis start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>创建集群</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 新版的redis集群创建使用redis-cli，主节点和从节点比例为1</span>
<span class="token comment"># slots：槽，用于装数据，主节点有，从节点没有</span>
redis-cli --cluster -a <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> create ip1:port1 ip2:port2 ip3:port3 ip4:port4 ip5:port5 ip6:port6 --cluster-replicas <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>检查集群信息</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>redis-cli --cluster check <span class="token number">192.168</span>.25.64:6380
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="slot槽节点"><a href="#slot槽节点" class="header-anchor">#</a> Slot槽节点</h2> <p>slot主要是用于存储redis的数据</p> <h3 id="分配"><a href="#分配" class="header-anchor">#</a> 分配</h3> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201216102449247.png" alt="image-20201216102449247" style="zoom:33%;"> <p>槽总数为16348，会被平均的分配到master的各个节点上</p> <h3 id="存储"><a href="#存储" class="header-anchor">#</a> 存储</h3> <img src="https://gitee.com/xuexuguang/images/raw/master/img/image-20201216102613004.png" alt="image-20201216102613004" style="zoom:33%;"> <p>集群模式下redis的key通过对key进行hash求模，最终计算得到数据落到哪个master的节点上。取数据的时候，会重定向到对应的节点上。</p> <h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <ul><li><a href="https://segmentfault.com/a/1190000003063859" target="_blank" rel="noopener noreferrer">Linux IO模式及 select、poll、epoll详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.cn/post/6844903886189395982" target="_blank" rel="noopener noreferrer">Redis的持久化详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.cn/post/6844904191236767751#heading-4" target="_blank" rel="noopener noreferrer">主从模式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/fcd40e2f9d19" target="_blank" rel="noopener noreferrer">Redis哨兵模式的安装<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/LXDOS/article/details/106419743" target="_blank" rel="noopener noreferrer">laravel集成哨兵模式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/fe7b7800473e" target="_blank" rel="noopener noreferrer">Redis Cluster及hash slot 算法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://segmentfault.com/a/1190000022029639" target="_blank" rel="noopener noreferrer">Redis 缓存雪崩、击穿、穿透<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.cn/post/6844904182609084424" target="_blank" rel="noopener noreferrer">看完这篇Redis缓存三大问题，保你面试能造火箭，工作能拧螺丝<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xuexuguang/notes/edit/master/docs/02.数据库/02.NoSQL/02.主从复制高可用Redis集群.md" target="_blank" rel="noopener noreferrer">编辑</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020/12/31, 06:55:18</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/ddfa16/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Redis的事务与订阅</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/ddfa16/" class="prev">Redis的事务与订阅</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/49ff8e/"><div>MVC对比</div></a> <span>12-31</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/f43ef4/"><div>负载均衡</div></a> <span>12-31</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/ff8f14/"><div>数据库缓存优化</div></a> <span>12-31</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div> </main></div> <div class="footer"><div class="icons"><a href="mailto:769076918@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xuexuguang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://y.qq.com/portal/player.html" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2020
    <span>Evan Xu | <a href="https://gitee.com/xuexuguang/notes/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.80f2c921.js" defer></script><script src="/assets/js/3.32955ad4.js" defer></script><script src="/assets/js/17.35ccb5bc.js" defer></script>
  </body>
</html>